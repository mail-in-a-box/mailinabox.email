<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>Mail-in-a-Box Setup Guide</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
    <style>
	    @import url(https://fonts.googleapis.com/css?family=Iceland);
	    @import url(https://fonts.googleapis.com/css?family=Raleway:400,700);
		@import url(https://fonts.googleapis.com/css?family=Ubuntu:300,500);


    	body {
    		font-family: Raleway, sans-serif;
    		font-size: 16px;
			color: #555;
    	}

		h1 {
			font-family: 'Iceland', sans-serif;
			font-size: 50px;
		}

		h2 {
			margin-top: 1.75em;
			font-family: Ubuntu, Arial, sans-serif;
			font-weight: bold;
			font-size: 20px;
			padding-bottom: .25em;
			border-bottom: 1px solid #DDD;
			margin-bottom: 1em;
		}

		h3 {
			margin-top: 1.5em;
			margin-bottom: .75em;
			font-family: Ubuntu, Arial, sans-serif;
			font-weight: 300;
			font-size: 17px;
			color: black;
		}

		a {
			color: #24A;
			text-decoration: underline;
		}

		#back {
			background-color: #EEE;
			font-size: 90%;
			padding: .5em;
		}
		#back a { text-decoration: none; }
		#back a:hover { text-decoration: underline; }

		p {
			margin-bottom: 1.25em; /* see .example, .figure, pre */
		}

		li {
			margin-bottom: .5em;
		}
		ul, ol {
			margin-bottom: 1em;
		}

		.example {
			margin: 1em 1em 1.3em 1.5em; /* bottom must match p */
			border: 1px solid #EEF;
			padding: .5em;
			background-color: #FAFAFF;
		}

		.figure {
			margin: 1.25em auto; /* bottom must match p */
		}

		pre {
			background-color: black;
			color: #FDD;
			font-weight: bold;
			margin-bottom: 1.75em; /* bottom must match p, but a bit larger looks better */
		}

		dl > dt {
			margin-top: 1em;
			margin-bottom: 3px;
			font-weight: normal;
			color: black;
		}
		dl > dt:before {
			display: inline-block;
			position: relative;
			top: 1px;
			content: "â˜‘";
			width: 20px;
		}
		dl > dd {
			margin-left: 20px;
		}

		code {
			 background-color: black;
			 color: #FDD;
			 font-weight: bold;
		}

		table { margin-bottom: 1.25em; }
		table thead th { border-bottom: 1px solid #555; }
		table th, table td {
			padding: .25em 1em .25em 0;
		}

		#nav {
			margin-top: 2em;
		}
			#nav a { padding-bottom: .25em; color: #E64; text-decoration: none; }
			#nav li { margin: 0; }
			#nav li.active { background-color: #D55; }
			#nav li.active a { color: white; }
			#nav li.active a:hover { color: #E64; }

    </style>
</head>
<body data-spy="scroll" data-target="#nav">
	<a href="https://github.com/mail-in-a-box/mailinabox" class="visible-md visible-lg"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>

	<div id="back">
		<div class="container">
			<a href="/">
				&lt; Back to Mail-in-a-Box
			</a>
		</div>
	</div>

	<div class="container">
    	<div class="row">
    		<div id="sidebar" class="col-sm-4 col-md-3">
				<div id="nav" class="small">
					<p style="margin: 0 0 .5em 14px; border-bottom: 1px solid #CCC; color: #888;">Table of Contents</p>
			        <ul class="nav nav-list">
			          <li><a href="#checklist">Checklist</a></li>
			          <li><a href="#domain-name-registration">Getting a Domain Name</a></li>
			          <li><a href="#hostname">The Box&rsquo;s Hostname</a></li>
			          <li><a href="#machine">The Machine</a></li>
			          <li><a href="#domain-name-configuration">Domain Name Configuration</a></li>
			          <li><a href="#setup">Machine Setup</a></li>
			          <li><a href="#admin">Administrative Page</a></li>
			          <li><a href="#web">Your Website</a></li>
			          <li><a href="#checks">Systems Checks</a></li>
			        </ul>
				</div>
    		</div>

    		<div class="col-sm-8 col-md-9">

    			<div style="padding-left: 1em; max-width: 55em">
	    			<h1>Mail-in-a-Box Setup Guide</h1>

	    			<h2 id="checklist">Pre-flight Checklist</h2>

	    			<dl>
	    				<dt>Can I use my box for something else too?</dt>
	    				<dd>No. Mail-in-a-Box must be installed on a <u>fresh</u> machine that will be <u>dedicated</u> to Mail-in-a-Box. You cannot modify the box. You are on your own if you try anything else.</dd>

	    				<dt>What about my website?</dt>
	    				<dd>Your Mail-in-a-Box wants to take over your DNS so that it can configure it correctly for email. We recommend you let the box manage your DNS but add a DNS record at the end of setup to point to the server that is running your website. If your website is just HTML pages, you can also copy it onto your Mail-in-a-Box.</dd>

	    				<dt>Can I run it at home?</dt>
	    				<dd>No. Most residential Internet service providers block outbound mail to prevent abuse by spammers, and most residential networks are blocked <a href="http://www.spamhaus.org/pbl/">on the receiving end</a> because of that spam problem. Your home IP address is also probably dynamic, which is also a problem.</dd>

	    				<dt>What will it cost?</dt>
	    				<dd>This is going to cost you about $15 per month. You&rsquo;re going to become your own Internet service provider &mdash; an ISP. You can divide this among friends and share your Mail-in-a-Box if you&rsquo;d like to split it up. Most of the cost is in having a (virtual) machine connected to the Internet 24/7.</dd>

	    				<dt>Do I have time?</dt>
	    				<dd>There&rsquo;s also your time. Once a Mail-in-a-Box is set up, we hope it &ldquo;just works&rdquo; but when you are your own system administrator you must be prepared to resolve issues as they arise.</dd>
	    			</dl>

	    			<h2 id="domain-name-registration">Your Domain Name</h2>

	    			<p>The first step in setting up a Mail-in-a-Box is to pick your new email address. An email address has two parts. The part after the @-sign is the <b>domain name</b>. Each domain name is owned by someone, and you are going to be the owner of your own.</p>

	    				<p class="example">Josh&rsquo;s email address is <script>document.write("tj".split("").reverse().join(""));</script>@occams.info. His domain name is <code>occams.info</code>.</p>

	    			<p>Some domain names have quirks, depending on which &ldquo;top-level domain&rdquo; (TLD) it is under (.com, .me, .io, and so on). When choosing a domain name, please consult our <a href="tld-quirks.html">TLD quirks page</a> first.</p>

	    			<p>Now go over to <a href="http://www.gandi.net/domain">Gandi.net</a>, a domain name registrar, and buy a new domain name. It&rsquo;s about $17/year (depending on TLD). Buy anything you want. This is your new identity.</p>

	    			<p>After you buy the name you&rsquo;ll need to set it up, but that comes later so keep reading. Note that a Mail-in-a-Box box can handle the email for multiple domains names too &mdash; more on that later.</p>

	    			<h2 id="hostname">Your Box Has A Name</h2>

	    			<p>Every machine connected to the Internet has a <b>name</b> and an <b>address</b>.</p>

	    			<p>The <b>address</b>, an IP address, is like a telephone number. It&rsquo;s made up of numbers and is assigned to you by whoever provides Internet access to you.</p>

	    			<p>The name &mdash; called a <b>hostname</b> &mdash; is something you decide. It can be a domain name you own or any &ldquo;subdomain&rdquo; of a domain you own.</p>

	    			<p>For your Mail-in-a-Box, we recommend naming your box <code>box</code> + <code>.</code> + your domain name.</p>

	    				<p class="example">Josh&rsquo;s Mail-in-a-Box is named <code>box.occams.info</code>. This is its hostname.</p>

	    			<p>Your Mail-in-a-Box may handle the email for multiple domain names, but the box has a single name.</p>


	    			<h2 id="machine">The Machine</h2>

	    			<p>Now you will rent a machine, or a virtual part of a machine, somewhere in &ldquo;the cloud.&rdquo; We&rsquo;ll call this machine your box.</p>

	    			<p>We recommend going over to <a href="https://www.digitalocean.com/">Digital Ocean</a>. You must choose the <code>Ubuntu 14.04 x64</code> operating system. We recommend using a machine with 1 GB of RAM and a 30 GB disk. This setup currently costs $10/month.</p>

	    			<p>At Digital Ocean, your machine is called a &ldquo;droplet&rdquo; and you <strong>must</strong> name your droplet the same as its hostname.</p>

	    				<p class="example">Josh&rsquo;s droplet would be named <code>box.occams.info</code> (if Josh used Digital Ocean).</p>

	    			<p>I've been a long-time customer of <a href="http://rimuhosting.com/order/v2orderstart.jsp">Rimuhosting.com</a> which also provides cheap virtual machines, which they call &ldquo;VPS&rdquo;s, at several locations around the world. Choose a location near you &mdash; it&rsquo;ll be faster! Most any cloud provider will do, but not Amazon Web Services because its network is often blocked to prevent users from sending spam. Wherever you rent your box, you <em>must</em> choose Ubuntu 14.04 x64 and at least 768 MB RAM.</p>

	    			<p>Each cloud provider will have different instructions for setting up &ldquo;reverse DNS.&rdquo; You <strong>must</strong> follow your cloud provider&rsquo;s instructions for setting the reverse DNS of your box to your box&rsquo;s hostname. At Digital Ocean you set the name of your droplet to the box&rsquo;s hostname, as mentioned above.</p>

	    				<p class="example">Josh&rsquo;s box&rsquo;s reverse DNS is set to the same as the box&rsquo;s hostname: <code>box.occams.info</code>.</p>

	    			<p>Your cloud provider will also now tell you the IP address of your machine. It looks like 123.123.123.123.</p>

	    				<p class="example">Josh&rsquo;s box&rsquo;s IP address is <code>94.76.202.152</code>.</p>


	    			<h2 id="domain-name-configuration">Configuring Your Domain Name</h2>

	    			<p>We&rsquo;ll now go back to your domain name registrar to associate your domain name with your box&rsquo;s IP address.</p>

	    			<h3>Advanced: External DNS</h3>

	    			<p>If you are using an external DNS provider, e.g. if you already have a website on your domain name, you may skip this section. However, we recommend that you continue and let your box take over your DNS so that it can set it up securely and correctly for email.</p>

	    			<p>If you choose to skip this section, pay special attention to &ldquo;System status & DNS&rdquo; toward the end.</p>

	    			<h3>Glue Records</h3>

	    			<p>The association between your domain name and IP address is . . . complicated. The domain name system (DNS) is a global, distributed network of machines that turn domain names into IP addresses. Your registrar and your box play a role in the domain name system.</p>

	    			<p>The way this works varies from registrar to registrar, but it goes something like this:</p>

	    			<p>First, you&rsquo;ll create two &ldquo;glue records.&rdquo; The purpose of glue records is to say that your box is becoming a part of the domain name system. These records go by different names at different registrars, so also look out for &ldquo;hostnames&rdquo; or &ldquo;child nameservers.&rdquo;. This will <em>not</em> be found in a DNS control panel. [<a href="http://wiki.gandi.net/en/domains/management/change-glue">Gandi instructions</a> | <a href="https://support.godaddy.com/help/article/664/setting-nameservers-for-your-domain-names">GoDaddy instructions</a>]</p>

	    			<p>A glue record consists of a hostname and an IP address. You will need two: <code>ns1.</code> + your box&rsquo;s hostname and <code>ns2.</code> + your box&rsquo;s hostname. (They stand for &ldquo;nameserver one&rdquo; and &ldquo;nameserver two&rdquo;.) For the IP address, enter the IP address of your box.</p>

	    				<p class="example">Josh&rsquo;s box&rsquo;s hostname is box.occams.info. The two glue records are for <code>ns1.box.occams.info</code> and <code>ns2.box.occams.info</code> and list the box&rsquo;s IP address of <code>94.76.202.152</code>.</p>

	    			<p>It looks something like what&rsquo;s shown here:</p>

	    			<img src="static/domain_hostnames.png" title="Glue Record Configuration at Your Domain Registrar" class="img-responsive figure"/>

	    			<p>Your registrar may ask you to enter these hostnames with the domain name part omitted, as mine did in this case. If so, enter the part of the hostname up to the domain name.</p>

	    				<p class="example">Josh&rsquo;s domain name is occams.info. The two glue hostnames are <code>ns1.box.occams.info</code> and <code>ns2.box.occams.info</code>, but his registrar asks him to enter them with &ldquo;.occams.info&rdquo; omitted leaving just <code>ns1.box</code> and <code>ns2.box</code>.</p>

	    			<p>If your Mail-in-a-Box is handling mail for multiple domains, you only do the part above once. Other domain names skip this step.</p>

	    			<h3>Nameservers</h3>

	    			<p>Second, you&rsquo;ll tell your domain registrar that your domain name&rsquo;s nameservers are <code>ns1</code> + <code>.</code> + your box&rsquo;s hostname and <code>ns2</code> + <code>.</code> + your box&rsquo;s hostname.</p>

	    			<p>You will usually be turning off the registrar&rsquo;s provided nameservers and turning on custom servers. This is usually <i>not</i> found in the domain name&rsquo;s DNS control panel. You will be disabling that control panel.</p>

	    			<p>Here&rsquo;s what that looks like in my registrar:</p>

	    			<img src="static/domain_nameservers.png" title="Nameserver Configuration at Your Domain Registrar" class="img-responsive figure"/>

	    			<p>This part <em>is</em> repeated for each domain name you associate with your box.</p>

	    			<p>Don&rsquo;t worry if you are confused about what this all means. It is complicated &mdash; we all get confused at this point.</p>

	    			<h3>DNSSEC DS Record</h3>

	    			<p>DNSSEC adds a security layer on top of DNS, in the same way that HTTPS adds a security layer to HTTP. It is not necessary, but it is recommended. When enabled, mail between Mail-in-a-Boxes will always be encrpyted.</p>

	    			<p>Your box&rsquo;s control panel will tell you to come back to your domain name registrar at the end to configure the DNSSEC DS record. It&rsquo;s not something the box can set up on its own, but you also can&rsquo;t configure it until after the box itself is set up &mdash; so you will come back to this.</p>


					<h2 id="setup">Setting Up The Box</h2>

					<p>You will now have to log into your running box using SSH. Your cloud provider will probably give you some instructions on how to do that. If your personal computer has a command line, you'll be doing something like this:</p>

					<pre>ssh -i yourkey.pem ubuntu@10.20.30.40</pre>

					<p>Once inside, you will now get the Mail-in-a-Box code onto your box and start its setup. Copy and paste this into your terminal and hit <key>enter</key>:</p>

					<pre>curl -s https://mailinabox.email/bootstrap.sh | sudo bash</pre>

					<p>You will be asked to enter the email address you want and a few other configuration questions. At the end you will be asked for a password for your email address.</p>

					<p>This password will be used to login to webmail, the administrative interface, and on your devices. It will <strong>not</strong> be used to log onto your Mail-in-a-Box server using SSH (that&rsquo;s what you did above).</p>

					<p>It is always safe to re-run the setup script, either because something went wrong or you just want to see it again. You can do so by just running <code>sudo mailinabox</code> from the command line.</p>

					<h2 id="admin">The Administrative Interface</h2>

					<h3>Connecting for the First Time</h3>

					<p>When the setup script is done running, you&rsquo;ll been given instructions on how to access your box&rsquo;s web-based administrative control panel:</p>

					<pre>Your Mail-in-a-Box is running.

Please log in to the control panel for further instructions at:

    https://94.76.202.152/admin

You will be alerted that the website has an invalid certificate. Check that
the certificate fingerprint matches:

C0:9B:FF:04:2B:2D:8F:47:5A:8B:D5:88:B7:05:D3:4B:6C:22:80:5F</pre>

					<p>Your SSL certificate is not yet signed so you will get a security warning when you visit the administrative URL. There is a way to proceed securely if you use Mozilla Firefox.</p>

					<ol>
					<li>Open the URL in Firefox. Firefox will say <em>This Connection is Untrusted</em>.</li>
					<li>Click on <em>I Understand the Risks</em>.</li>
					<li>Click on <em>Add Exception</em>.</li>
					<li>Click on <em>View</em>.</li>
					<li>Compare the <em>SHA1 Fingerprint</em> in Firefox to the fingerpint reported by Mail-in-a-Box&rsquo;s setup script in your SSH connection (see the example above). If they match, it is safe to continue.</li>
					<li>Click on <em>Close</em>.</li>
					<li>Click on <em>Confirm Security Exception</em>. It is safe (and convenient!) to permanently store the exception.</li>
					</ol>

					<p>The page will then load securely.</p>

					<p>You can also get a signed SSL certificate later (see below) so you don&rsquo;t have to go through these steps.</p>

					<h3>System status &amp; DNS</h3>

					<p>Log in to the administrative control panel with the email address and password that you provided during Mail-in-a-Box&rsquo;s setup. Proceed to the System Status Checks.</p>

					<p>These checks will guide you toward finishing your setup:</p>

					<p>The control panel will check if your DNS is set up correctly. Things related to the domain name system sometimes take several minutes, or much longer, to update. This is called DNS propagation. Wait for the control panel to report no DNS problems &mdash; reload the page every 15 minutes or so. If problems persist, something went wrong.</p>

					<p>DNSSEC is an optional step that adds additional security to DNS. The control panel will walk you through setting up DNSSEC as well. You will need to go back to your domain name registrar and enter additional information.</p>

					<p><em>If you skipped the DNS settings earlier, you should now go to the DNS (Custom/External) &gt; External DNS section of the control panel and copy the DNS records into your own DNS control panel.</em></p>

					<h3>Getting a signed SSL certificate</h3>

					<p>Getting a signed SSL certificate is optional but is highly recommended and will remove the security exception warnings from a) the control panel and b) when you start checking and sending mail. The control panel will walk you through this.</p>

					<p>If you skip this, you can still safely check your email if you verify any certificate warnings like above.</p>

					<h3>Checking your email</h3>

					<p>The administrative control panel will provide instructions for how to check your email with webmail, IMAP/SMTP, or Exchange/ActiveSync.</p>

					<p>You can also add or remove additional email accounts and mail aliases (forwarders).</p>

					<h3>Advanced tools</h3>

					<p>The administrative control panel also helps you with...</p>

					<ul>
					<li>Setting up contact and calendar synchronization</li>
					<li>Checking the status of backups</li>
					<li>Setting custom DNS records, e.g. if you run a website on the same domain name but on another machine.</li>
					</ul>

					<h2 id="web">Publishing a Static Website</h2>

					<p>Your box will immediately begin serving a simple, default static website at the box&rsquo;s hostname and on any domain that you set up an email address for.</p>

					<p>Replace the files in <tt>/home/user-data/www/default</tt> on your box with any HTML pages and other static files for your own website. You will probably need to use an SSH file transfer program such as <a href="https://filezilla-project.org/">FileZilla</a> or <a href="http://linuxcommand.org/man_pages/scp1.html">scp</a>. (Use the same login credentials as when you connected with <tt>ssh</tt>.)</p>

					<p>If you want a different website to appear at different domain names, put the files instead in <tt>/home/user-data/www/[your.domainname.com]</tt>. Then run:</p>

					<pre>sudo tools/web_update</pre>

					<p>to update the web configuration so that it knows the new location of the static files.</p>

					<p>If you want to have the box host a static website on a domain that you have&rsquo;t set up an email address for, create a dummy email address on the domain (see above for how to do that). Then check the System Status page in the administrative control panel.</p>


					<h2 id="maintenance">Keeping Your Box Humming</h2>

					<p>Follow <a href="http://twitter.com/Mailinabox">@Mailinabox</a> on Twitter so you know when we post any updates to Mail-in-a-Box.</p>

					<p>You should periodically update the software on Mail-in-a-Box. Every now and then update the Ubuntu base packages in case there have been any security updates. Log into your machine with SSH and then type:</p>

					<pre>sudo apt-get update &amp;&amp; sudo apt-get upgrade</pre>

					<p>You should also move to the latest Mail-in-a-Box release occasionally. To do so, go back to the section called <a href="#machine">Setting Up The Box</a> and follow the same steps again.</p>

					<p>Remember that it is always safe to re-run the setup script by typing <code>sudo mailinabox</code> at the SSH terminal prompt.</p>

					<h2 id="checks">Systems Checks</h2>

					<p>If you want to double-check that your system is configured correctly, here are some tools:</p>

					<ul>
						<li>DNS: <a href="http://pingability.com/zoneinfo.jsp">pingability.com/zoneinfo</a></li>
						<li>DKIM and SPF: <a href="http://www.brandonchecketts.com/emailtest.php">brandonchecketts.com/emailtest</a></li>
						<li>SSL: <a href="https://www.ssllabs.com/ssltest/analyze.html">ssllabs.com</a></li>
					</ul>

					<div class="hidden-xs" style="height: 200px"> </div>

    		</div>

    	</div>
	</div>

	<script src="https://code.jquery.com/jquery-2.1.1.min.js"> </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<script>
		if ($(window).width() >= 768) {
			// scroll spy with a fixed TOC doesn't work on small screens
			$('#nav').attr('data-spy', 'affix');
			$('body').scrollspy()
		}
	</script>
</body>
</html>
